<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD Chunker WebUI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="app-container">
    <header>
        <h1><i class="fa-brands fa-markdown"></i> MD Chunker</h1>
        <p>Clean, Split, and JSON-ify your Markdown files</p>
    </header>

    <!-- STEP 1: UPLOAD & SETTINGS -->
    <div id="step-1" class="slide active">
        
        <div class="media-info" style="justify-content: center; border: 2px dashed var(--border); cursor: pointer;" onclick="document.getElementById('file-input').click()">
            <div style="text-align: center; padding: 20px;">
                <i class="fa-solid fa-cloud-arrow-up" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                <h3 style="margin:0;">Click to Upload .MD Files</h3>
                <p style="color: var(--text-muted); font-size: 0.8rem;">Supported: Markdown (.md)</p>
            </div>
            <input type="file" id="file-input" multiple accept=".md" style="display: none;">
        </div>

        <div id="file-list-display" style="margin-bottom: 1rem; color: var(--success); font-size: 0.9rem; text-align: center;"></div>

        <div class="options-grid">
            <div class="field">
                <label>Chunk Size (Chars)</label>
                <input type="number" id="chunk-size" value="4000">
            </div>
            <div class="field">
                <label>Chunk Overlap</label>
                <input type="number" id="chunk-overlap" value="400">
            </div>
        </div>

        <details class="advanced-settings">
            <summary><i class="fa-solid fa-gear"></i> Advanced Details</summary>
            <div class="advanced-content">
                <p style="font-size: 0.85rem; color: var(--text-muted);">
                    This tool uses a Hybrid Splitter:<br>
                    1. <b>MarkdownHeaderTextSplitter</b>: Preserves H1-H3 structure.<br>
                    2. <b>RecursiveCharacterTextSplitter</b>: Enforces size limits.<br>
                    <br>
                    Outputs are compatible with Vector DBs like Pinecone/Milvus.
                </p>
            </div>
        </details>

        <div class="actions">
            <button class="btn-primary full-btn" id="convert-btn">
                <i class="fa-solid fa-bolt"></i> Process Files
            </button>
        </div>
        
        <!-- History Mockup -->
        <div class="history-panel">
            <h3>Recent Sessions</h3>
            <ul id="history-list">
                <li style="color: var(--text-muted); font-style: italic;">No recent history</li>
            </ul>
        </div>
    </div>

    <!-- STEP 2: PROCESSING (Loading) -->
    <div id="step-2" class="slide">
        <h2 style="margin-top: 40px;">Processing...</h2>
        <div class="task-list">
            <div class="task-item running">
                <div class="task-icon"><i class="fa-solid fa-circle-notch"></i></div>
                <div class="task-info">
                    <div class="task-header">Analyzing Structure</div>
                    <div class="task-detail">Parsing Headers & Code Blocks...</div>
                    <div class="progress-track"><div class="progress-fill" style="width: 60%"></div></div>
                </div>
            </div>
            <div class="task-item">
                <div class="task-icon"><i class="fa-solid fa-scissors"></i></div>
                <div class="task-info">
                    <div class="task-header">Splitting Text</div>
                    <div class="task-detail">Applying overlap logic...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 3: RESULT -->
    <div id="step-3" class="slide">
        <div class="success-icon"><i class="fa-solid fa-circle-check"></i></div>
        <h2>Processing Complete!</h2>

        <div class="result-card">
            <div style="background: var(--surface); width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; border-radius: 8px; border: 1px solid var(--border);">
                <i class="fa-regular fa-file-zipper" style="font-size: 2.5rem; color: var(--text-muted);"></i>
            </div>
            <div class="res-details">
                <h4 id="result-title">chunked_output.zip</h4>
                <p id="result-stats">Ready for download</p>
            </div>
        </div>

        <div class="task-list" id="log-container" style="max-height: 150px; overflow-y: auto; margin-bottom: 20px;">
            <!-- Logs injected here -->
        </div>

        <div class="actions vertical">
            <a href="#" id="download-btn" class="btn-primary full-btn" style="text-decoration: none;">
                <i class="fa-solid fa-download"></i> Download ZIP
            </a>
            <button class="btn-secondary full-btn" onclick="location.reload()">
                <i class="fa-solid fa-rotate-left"></i> Process More
            </button>
        </div>
    </div>

</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>